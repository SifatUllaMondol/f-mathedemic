<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mathedemic | Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: "Inter", sans-serif;
        }
    </style>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-md bg-white rounded-xl shadow-lg p-8 space-y-6">
        <div class="text-center">
            <h1 class="text-3xl font-extrabold text-gray-800">Welcome Back!</h1>
            <p class="mt-2 text-gray-600">Please log in to continue.</p>
        </div>

        <form id="loginForm" class="space-y-4">
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                <input type="email" id="email" name="email" required
                    class="mt-1 block w-full px-4 py-2 bg-gray-50 border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-teal-500 transition duration-300" />
            </div>

            <div>
                <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                <input type="password" id="password" name="password" required
                    class="mt-1 block w-full px-4 py-2 bg-gray-50 border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-teal-500 transition duration-300" />
            </div>

            <button type="submit"
                class="w-full py-3 px-4 bg-teal-600 hover:bg-teal-700 text-white font-bold rounded-lg shadow-lg transform transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-teal-300">
                Login
            </button>
        </form>
        <div class="flex justify-end mt-4">
            <a href="create-user.html" class="text-sm text-teal-600 hover:text-teal-800 transition-colors duration-200">
                Don't have an account? Sign Up
            </a>
        </div>
        <div id="message" class="text-center p-3 rounded-lg hidden"></div>
    </div>

    <script>
        document
            .getElementById("loginForm")
            .addEventListener("submit", async function (event) {
                event.preventDefault();

                const messageDiv = document.getElementById("message");
                messageDiv.textContent = "";
                messageDiv.classList.add("hidden");

                const email = document.getElementById("email").value;
                const password = document.getElementById("password").value;

                try {
                    const response = await fetch("/api/login", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ email, password }),
                    });

                    const data = await response.json();

                    if (response.ok) {
                        messageDiv.textContent = data.message;
                        messageDiv.classList.remove(
                            "hidden",
                            "bg-red-200",
                            "text-red-800"
                        );
                        messageDiv.classList.add("bg-green-200", "text-green-800");

                        // Store the token and userId for future use
                        localStorage.setItem("token", data.token);
                        localStorage.setItem("userId", data.userId);

                        // Redirect to the test page after a short delay
                        window.location.href = "/index.html";
                    } else {
                        messageDiv.textContent = data.error || "Login failed.";
                        messageDiv.classList.remove(
                            "hidden",
                            "bg-green-200",
                            "text-green-800"
                        );
                        messageDiv.classList.add("bg-red-200", "text-red-800");
                    }
                } catch (error) {
                    console.error("Network error:", error);
                    messageDiv.textContent =
                        "An unexpected error occurred. Please try again.";
                    messageDiv.classList.remove(
                        "hidden",
                        "bg-green-200",
                        "text-green-800"
                    );
                    messageDiv.classList.add("bg-red-200", "text-red-800");
                }
            });
    </script>
</body>

</html>